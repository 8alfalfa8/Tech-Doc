# ライブラリ依存図

---

## ライブラリ依存図とは

ライブラリ依存図（Library Dependency Diagram）は、システムやアプリケーションが使用する外部ライブラリや内部ライブラリ間の依存関係を可視化した図です。AP（アプリケーション）基盤の基本設計書において、システムの構成要素間の関係を明確にするために作成されます。

## 作成目的

1. **依存関係の可視化**：システムがどの外部ライブラリに依存しているかを明確にする
2. **影響範囲の特定**：ライブラリ変更時の影響範囲を把握する
3. **バージョン管理**：使用ライブラリのバージョン関係を整理する
4. **技術的負債の把握**：不要な依存関係や古いバージョンのライブラリを特定する

## 作成手順

### 1. 使用ライブラリの洗い出し
- プロジェクトで使用しているすべてのライブラリをリストアップ
- 主要なカテゴリ分け（データベース、ロギング、セキュリティなど）

### 2. 依存関係の分析
- 各ライブラリが依存している他のライブラリを調査
- 推移的依存関係（間接的な依存）も含めて分析

### 3. 図の作成
- ツールを使用して図を作成（後述のツールを参照）
- 主要な要素：
  - ノード：各ライブラリを表す
  - エッジ：依存関係を表す矢印
  - ラベル：バージョン情報などを記載

### 4. ドキュメント化
- 図に説明文を追加
- 各ライブラリの役割や選択理由を簡潔に記載
- バージョン情報とアップデートポリシーを明記

## 記載例（基本設計書向け）

```
### ライブラリ依存図

[図の挿入または図番号参照]

#### 主要ライブラリ一覧
| カテゴリ | ライブラリ名 | バージョン | 用途 |
|----------|-------------|------------|------|
| Webフレームワーク | Spring Boot | 2.7.5 | REST API実装 |
| データベース | Hibernate | 5.6.10 | ORマッピング |
| セキュリティ | Spring Security | 5.7.4 | 認証・認可 |

#### 依存関係の特徴
- 主要フレームワークとしてSpring Bootを採用
- データベースアクセスにはHibernateを利用
- セキュリティ機能はSpring Securityに一元化
```

## ベストプラクティス

1. **階層化**：複雑な場合はレイヤーごとに図を分ける
2. **バージョン管理**：図にバージョン情報を含める
3. **定期的な更新**：ライブラリ更新時に図も更新
4. **循環依存の排除**：循環参照がある場合は設計見直しを検討
5. **不要な依存の明示**：使用していないのに依存しているライブラリを明記

ライブラリ依存図を作成・維持することで、システムの健全性を保ち、技術的負債の蓄積を防ぐことができます。

---

## ライブラリ依存図の検証ポイント

ライブラリ依存図を作成する際に確認すべき重要な検証ポイントを以下にまとめます。

### 1. 依存関係の正確性に関する検証

- **依存関係の網羅性**：すべての依存ライブラリが記載されているか
- **バージョンの正確性**：記載バージョンが実際のプロジェクトと一致しているか
- **推移的依存の考慮**：間接的に依存しているライブラリも含まれているか
- **開発/テスト/本番環境の差異**：環境ごとに依存関係が異なる場合はその違いが明確か

### 2. セキュリティ関連の検証

- **脆弱性のあるバージョン**：既知の脆弱性があるバージョンが使用されていないか
- **サポート終了ライブラリ**：メンテナンスが終了しているライブラリが含まれていないか
- **過剰な権限**：必要以上の権限を要求するライブラリが含まれていないか
- **ライセンスの適合性**：使用ライブラリのライセンスがプロジェクトの要件に適合しているか

### 3. パフォーマンス関連の検証

- **重複依存**：同じ機能を持つ複数のライブラリが依存関係に含まれていないか
- **サイズの肥大化**：巨大なライブラリが不必要に含まれていないか
- **非効率な依存**：特定の機能だけのために大きなライブラリ全体を依存していないか

### 4. アーキテクチャ上の検証

- **循環依存**：ライブラリ間で循環参照が発生していないか
- **レイヤー違反**：アーキテクチャレイヤーを跨いだ不適切な依存がないか
- **密結合な依存**：変更の影響が広範囲に及ぶ密結合な依存関係がないか

### 5. メンテナンス性に関する検証

- **最新性**：可能な範囲で最新バージョンが使用されているか
- **代替ライブラリの存在**：廃止予定のライブラリに代替案が検討されているか
- **ドキュメントの整合性**：依存図と実際のプロジェクト設定ファイルが一致しているか

### 6. ビジネスリスクの検証

- **ベンダーロックイン**：特定ベンダーに過度に依存した構成になっていないか
- **技術的負債**：将来のメンテナンスコストが高くなるような依存関係がないか
- **スキルセットの適合性**：チームのスキルセットと使用ライブラリが適合しているか

### 検証実施方法

1. **自動ツールによる検証**：
   - OWASP Dependency-Checkなどの脆弱性スキャンツール
   - ビルドツールの依存関係分析機能（mvn dependency:analyzeなど）

2. **手動レビュー**：
   - アーキテクチャチームによる設計レビュー
   - セキュリティチームによるライブラリの安全性レビュー

3. **継続的インテグレーション**：
   - CIパイプラインに依存関係チェックを組み込む
   - 更新時の自動チェックを設定

これらの検証ポイントを網羅的に確認することで、健全で安全なライブラリ依存関係を構築・維持することができます。
